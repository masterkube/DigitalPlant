<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Digital Plant</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/vertical-layout-light/style.css">
  <link rel="stylesheet" href="css/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="js/raphael.js"></script>
  <script src="js/treant.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <!-- endinject -->
  <link rel="shortcut icon" href="./images/Shortcut Logo.png" />

  <style>
    a:hover{
      color: #ffffff;
    } 
    .link {
      stroke: #ff6600;
      opacity: 100;
      stroke-width: 5px;
    }
    .node circle {
      stroke: rgb(255, 255, 255);
      opacity: 100;
      stroke-width: 3px;
    }
    text {
      font: 25px serif;
      opacity: 100;
      pointer-events:none;
    }
    .grid-container {
      display: grid;
      grid-template-columns: auto auto;
    }
    .grid-item {
      background-color: inherit;
      border: 1px;
      padding:inherit;
      text-align: center;
      width: auto;
    }
    #confirm {
          display: none;
          background-color: #ff6600;
          color: #000000;
          border: 4px solid rgba(255, 255, 255, 0.871);
          position: fixed;
          width: 300px;
          height: 100px;
          left: 40%;
          top: 40%;
          box-sizing: border-box;
          text-align: center;
        }
        #confirm button {
          background-color: #0e2a5d;
          display: inline-block;
          border-radius: 12px;
          border: 4px solid rgb(255, 255, 255);
          padding: 5px;
          text-align: center;
          width: 60px;
          cursor: pointer;
          color: #ffff;
        }
        #confirm .message {
          text-align: left;
          background-color: #ff6600;
          color: black;
          text-align: center;
          margin-top: 5px;
        }
    #tree-simple3 {
      width: 15%;
      position: fixed;
      left: 0;
      top: 60px;
      bottom: 0;
      overflow-y: auto;
      border-right: 1px solid #ccc;
      z-index: 1000;
      display: none; /* Hide by default */
      transition: transform 0.3s ease-in-out;
    }
    .menu-item {
      padding: 10px;
      font-size: 15px;
      border-bottom: 1px solid #ccc;
      cursor: pointer;
      background-color: #0e2a5d;
      color: #ffffff;
      transition: background-color 0.3s, color 0.3s;
    }
    .menu-item:hover {
      background-color: #ff6600;
      color: #0e2a5d;
    }

    .dropdown-menu {
      background-color: #0e2a5d;
      border: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 10px;
    }

    .dropdown-item {
      color: #ffffff;
      padding-left: 1rem;
      padding-right: 2rem;
      border-radius: 4px;
      transition: background-color 0.3s, color 0.3s;
    }

    .dropdown-item:hover {
      background-color: #ff6600;
      color: #0e2a5d;
    }

    /* Style for buttons */
    .btn {
      background-color: #0e2a5d;
      color: #ffffff;
      border: none;
      border-radius: 12px;
      transition: background-color 0.3s, color 0.3s;
    }
    .btn:hover {
      background-color: #ff6600;
      color: #0e2a5d;
    }
  </style>

<script>

  graph=[]
  mainlinks=[]

  function objeql(obj1,dataarr) {
    flag=0
    for(j=0;j<dataarr.length;j++){
      if (obj1.source == dataarr[j].source && obj1.target == dataarr[j].target) {
        flag=1;
        break;
      }
      else{
        flag=0;
      }
    }
    if (flag==0)
    {
      return 0;
    }
    else{
      return 1;
    }
  }
  
  function getroot(str){
    var arr = str.split("/");
    var info = graph.includes(arr[7])
    if(info==false){
      graph.push(arr[7])
    }
  }

  function  getContent4(url){
    var req = new XMLHttpRequest();
    req.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        res = req.responseXML;
        res1 = res.getElementsByTagName("Element");
        if (url.search("Ask") > 0){
          document.getElementById("innertable").innerHTML=""
          var hd2 = []
          var td2 = []
          for (i = 0; i< res1.length;i++){
            if(res1[i].children[1].innerHTML=="date"){
              if(res1[i].children.length==3){
                //document.getElementById("innertable").innerHTML+="<tr><td>"+res1[i].children[0].innerHTML+" :</td> <td><input class='form-control' type='date' value='"+res1[i].children[2].innerHTML+"'> </td></tr>"
                hd2.push(res1[i].children[0].innerHTML)
                td2.push("<td><input class='form-control' type='date' id='twoask"+i+"' value='"+res1[i].children[2].innerHTML+"'> </td>")
              }else{
                //document.getElementById("innertable").innerHTML+="<tr><td>"+res1[i].children[0].innerHTML+" :</td> <td><input class='form-control' type='date'> </td></tr>"
                hd2.push(res1[i].children[0].innerHTML)
                td2.push("<td><input class='form-control' type='date' id='twoask"+i+"'> </td>")
              }
              }
              else if(res1[i].children[1].innerHTML=="number"){
                if(res1[i].children.length==3){
                  //document.getElementById("innertable").innerHTML+="<tr><td>"+res1[i].children[0].innerHTML+" :</td><td> <input class='form-control' type='number' value='"+res1[i].children[2].innerHTML+"'> </td></tr>"
                  hd2.push(res1[i].children[0].innerHTML)
                  td2.push("<td> <input class='form-control' type='number' id='twoask"+i+"' value='"+res1[i].children[2].innerHTML+"'> </td>")
                }else{
                  //document.getElementById("innertable").innerHTML+="<tr><td>"+res1[i].children[0].innerHTML+" :</td><td> <input class='form-control' type='number'> </td></tr>"
                  hd2.push(res1[i].children[0].innerHTML)
                  td2.push("<td> <input class='form-control' type='number' id='twoask"+i+"'> </td>")
                }  
              }
              else{
                if(res1[i].children.length==3){
                  //document.getElementById("innerdata").innerHTML+="<tr><td>"+res1[i].children[0].innerHTML+" :</td><td> <input class='form-control' type='text' value='"+res1[i].children[2].innerHTML+"'> </td></tr>"
                  hd2.push(res1[i].children[0].innerHTML)
                  td2.push("<td> <input class='form-control' type='text' id='twoask"+i+"' value='"+res1[i].children[2].innerHTML+"'> </td>")
                }else{
                  //document.getElementById("innerdata").innerHTML+="<tr><td>"+res1[i].children[0].innerHTML+" :</td><td> <input class='form-control' type='text'> </td></tr>"
                  hd2.push(res1[i].children[0].innerHTML)
                  td2.push("<td> <input class='form-control' type='text' id='twoask"+i+"'> </td>")
                }
              }
            }
          var askttble2 = "<thead><tr>"
          for (var hea of hd2){askttble2+="<th>"+hea+"</th>"}
          askttble2+="</tr></thead>"
          askttble2+="<tr>"
          for (var bod of td2){askttble2+=bod}
          askttble2+="<td><input class='btn btn-primary btn-rounded btn-fw' type='submit' onclick='postask1(`"+url+"`,`"+hd2+"`,`twoask`)' value='submit'> <input class='btn btn-primary btn-rounded btn-fw' type='reset' value='clear'> </td>"
          askttble2+="</tr>"
          document.getElementById("innertable").innerHTML=askttble2
          //document.getElementById("innertable").innerHTML+="<tr><td colspan='2' style='text-align:center;'> <input class='btn btn-primary btn-rounded btn-fw' type='submit' value='submit'> <input class='btn btn-primary btn-rounded btn-fw' type='reset' value='clear'> </td></tr></form>"
        }
        else{
          var in_url = ""
          for(i = 0;i<res1.length;i++){
            if(res1[0].children.length>2){
              in_url = res1[0].children[2].innerHTML;
            }else{
              continue
            }
          }
          if (in_url.search("http")>=0){
            var hd3 =[]
            var td3 =[]
              //document.getElementById("innertable").innerHTML="<thead><tr><th>Data</th><th>Value</th></tr></thead>"
              for(i = 0;i<res1.length;i++){
                if (res1[i].children[1].innerHTML=="name") {
                  if(res1[i].children.length>2){
                    getroot(res1[i].children[2].innerHTML)
                    hd3.push("Pointer")
                    td3.push("<button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+res1[i].children[2].innerHTML+"`)'>"+res1[i].children[0].innerHTML+"</button>")
                  //document.getElementById("innertable").innerHTML+="<tr><td colspan='2' style='text-align:center;'><button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+rres1[i].children[2].innerHTML+"`)'>"+rres1[i].children[0].innerHTML+"</button></td></tr>";
                  }else{
                    continue
                  }
                }
                else {
                  if (res1[i].children.length > 2){
                    hd3.push(res1[i].children[0].innerHTML)
                    td3.push(res1[i].children[2].innerHTML)
                  }
                  // td1.push(rres1[i].children[2].innerHTML)
                  //document.getElementById("innertable").innerHTML+="<tr><td>"+rres1[i].children[0].innerHTML+" :</td> <td>"+rres1[i].children[2].innerHTML+"</td></tr>"
                }
              }
              var tble3 = "<thead><tr>"
              for (var he3 of hd3){tble3+="<th>"+he3+"</th>"}
              tble3+="</tr></thead>"
              tble3+="<tr>"
              for (var bd3 of td3){tble3+="<td>"+bd3+"</td>"}
              tble3+="</tr>"
              document.getElementById("innertable").innerHTML=tble3
          }
          else if (in_url.search("http")<0){
            var hd2 =[]
            var td2 =[]
              //document.getElementById("innertable").innerHTML="<thead><tr><th>Data</th><th>Value</th></tr></thead>"
              for(i = 0;i<res1.length;i++){
                if (res1[i].children[1].innerHTML=="name") {
                  if(res1[i].children.length>2){
                    getroot(res1[i].children[2].innerHTML)
                    hd2.push("Pointer")
                    td2.push("<button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+res1[i].children[2].innerHTML+"`)'>"+res1[i].children[0].innerHTML+"</button>")
                    //document.getElementById("innertable").innerHTML+="<tr><td colspan='2' style='text-align:center;'><button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+rres1[i].children[2].innerHTML+"`)'>"+rres1[i].children[0].innerHTML+"</button></td></tr>";
                  }else{
                    continue
                  }
                }
                else {
                  if (res1[i].children.length > 2){
                    hd2.push(res1[i].children[0].innerHTML)
                    td2.push(res1[i].children[2].innerHTML)
                  }
                  // td1.push(rres1[i].children[2].innerHTML)
                  //document.getElementById("innertable").innerHTML+="<tr><td>"+rres1[i].children[0].innerHTML+" :</td> <td>"+rres1[i].children[2].innerHTML+"</td></tr>"
                }
              }
              var tble2 = "<thead><tr>"
              for (var he2 of hd2){tble2+="<th>"+he2+"</th>"}
              tble2+="</tr></thead>"
              tble2+="<tr>"
              for (var bd2 of td2){tble2+="<td>"+bd2+"</td>"}
              tble2+="</tr>"
              document.getElementById("innertable").innerHTML=tble2
          }
          else{
            if (res1[0].children[2].innerHTML.search("/2/Tell") > 0){
              // console.log("log",res1[0].children[2].innerHTML)
              var temp_url = res1[0].children[2].innerHTML
              // var temp_name = res1[0].children[0].innerHTML
              // var url_fire = temp_url.replace(temp_name,temp_name.slice(2,temp_name.length))
              // var url_fire1 = temp_url.replace("2","1")
              var url_fire1 = temp_url.replace("/2/Tell", "/1/Tell")
              // console.log("log2",url_fire1);
              var rreq = new XMLHttpRequest();
              rreq.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  rres = rreq.responseXML;
                  rres1 = rres.getElementsByTagName("Element");
                  document.getElementById("innertable").innerHTML=""
                  var hd1 =[]
                  var td1 =[]
                  //document.getElementById("innertable").innerHTML="<thead><tr><th>Data</th><th>Value</th></tr></thead>"
                  for(i = 0;i<rres1.length;i++){
                    if (rres1[i].children[1].innerHTML=="name") {
                      if(rres1[i].children.length>2){
                        getroot(rres1[i].children[2].innerHTML)
                        hd1.push("Pointer")
                        // console.log(rres1[i].children[2].innerHTML)
                        td1.push("<button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+rres1[i].children[2].innerHTML+"`)'>"+rres1[i].children[0].innerHTML+"</button>")
                        //document.getElementById("innertable").innerHTML+="<tr><td colspan='2' style='text-align:center;'><button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+rres1[i].children[2].innerHTML+"`)'>"+rres1[i].children[0].innerHTML+"</button></td></tr>";
                      }else{
                        continue
                      }
                    }
                    else {
                      if (rres1[i].children.length > 2){
                        hd1.push(rres1[i].children[0].innerHTML)
                        td1.push(rres1[i].children[2].innerHTML)
                      }
                      // td1.push(rres1[i].children[2].innerHTML)
                      //document.getElementById("innertable").innerHTML+="<tr><td>"+rres1[i].children[0].innerHTML+" :</td> <td>"+rres1[i].children[2].innerHTML+"</td></tr>"
                    }
                  }
                  var tble1 = "<thead><tr>"
                  for (var he1 of hd1){tble1+="<th>"+he1+"</th>"}
                  tble1+="</tr></thead>"
                  tble1+="<tr>"
                  for (var bd1 of td1){tble1+="<td>"+bd1+"</td>"}
                  tble1+="</tr>"
                  document.getElementById("innertable").innerHTML=tble1
                }
                if (this.status == 403 ){
                  throwblocked();
                }
              }
              rreq.open("GET", proxy+url_fire1,true);
              rreq.overrideMimeType('text/xml');
              rreq.setRequestHeader('username', user);
              rreq.send(); 
            }
            else{
              var rreq = new XMLHttpRequest();
              rreq.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  rres = rreq.responseXML;
                  rres1 = rres.getElementsByTagName("Element");
                  document.getElementById("innertable").innerHTML=""
                  var hd =[]
                  var td =[]
                  //document.getElementById("innertable").innerHTML="<thead><tr><th>Data</th><th>Value</th></tr></thead>"
                  for(i = 0;i<rres1.length;i++){
                    if (rres1[i].children[1].innerHTML=="name") {
                      if(rres1[i].children.length>2){
                        getroot(rres1[i].children[2].innerHTML)
                        hd.push("Pointer")
                        td.push("<button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+rres1[i].children[2].innerHTML+"`)'>"+rres1[i].children[0].innerHTML+"</button>")
                        //document.getElementById("innertable").innerHTML+="<tr><td colspan='2' style='text-align:center;'><button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+rres1[i].children[2].innerHTML+"`)'>"+rres1[i].children[0].innerHTML+"</button></td></tr>";
                      }else{
                        continue
                      }
                    }
                    else {
                      if (rres1[i].children.length>2){
                        hd.push(rres1[i].children[0].innerHTML)
                        td.push(rres1[i].children[2].innerHTML)
                      }
                      // td.push(rres1[i].children[2].innerHTML)
                      //document.getElementById("innertable").innerHTML+="<tr><td>"+rres1[i].children[0].innerHTML+" :</td> <td>"+rres1[i].children[2].innerHTML+"</td></tr>"
                    }
                  }
                  var tble = "<thead><tr>"
                  for (var he of hd){tble+="<th>"+he+"</th>"}
                  tble+="</tr></thead>"
                  tble+="<tr>"
                  for (var bd of td){tble+="<td>"+bd+"</td>"}
                  tble+="</tr>"
                  document.getElementById("innertable").innerHTML=tble
                }
                if (this.status == 403 ){
                  throwblocked();
                }
              }
              rreq.open("GET", proxy+in_url,true);
              rreq.overrideMimeType('text/xml');
              rreq.setRequestHeader('username', user);
              rreq.send(); 
            }
          }
        } 
      }
      if (this.status == 403 ){
        throwblocked();
      }
    }
    req.open("GET", proxy+url,true);
    req.overrideMimeType('text/xml');
    req.setRequestHeader('username', user);
    req.send(); 
  }
  
  function validatedate(x){
    var date_regex = /^\d{4}([./-])\d{2}\1\d{2}$/;
    return date_regex.test(x);
  }

  function postask1(url,data,field) {
    data = data.split(",")
    postdata=""
    for(k = 0; k< data.length;k++){
      var tmpdata = document.getElementById("oneask"+k+"")
      if (typeof tmpdata !== undefined && tmpdata !== null ){
        if ( data[k].toLowerCase().search("date") >= 0 ){
          var tempp = document.getElementById(field+k).value
          tempp = encodeURIComponent(tempp.split('-').reverse().join("/"))
        }
        if(validatedate(document.getElementById(field+k).value) == true){
          tempp = encodeURIComponent(document.getElementById(field+k).value.split('-').reverse().join("/"))
        }
        else{
          try {
            lenOfAutoName = document.getElementsByName(field+k).length-1;
            var interdata = document.getElementsByName(field+k)[lenOfAutoName].value;
            var tempp = interdata
          }
          catch (error){
            var tempp = document.getElementById(field+k).value
            // console.log(error.name);
          }
        }
        postdata+=""+data[k]+"="+tempp
      }
      else{
        postdata+=""+data[k]+"="+" "
      }
      postdata+="&"
    }
    getarr = url.split("/");
    postdata+="ask=true&Process="+getarr[7]+"&askProcessValue="+getarr[7]+"&pid="+getarr[8]+"&askPidValue="+getarr[8]+"&askActionValue="+getarr[9]+"&Action="+getarr[9]+"&askId="+getarr[10]+"&domain="+getarr[6]

    var posthttp = new XMLHttpRequest();
    posthttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200 ) {
        const postres = posthttp.responseText
        // console.log(postres)
        document.getElementById("auxdata").innerHTML=""
        if (postres.search("true")>0) {
          console.log("ASK Success");
          var confirmBox = $("#confirm");
          confirmBox.find(".message").text("Submitted Successfully");
          confirmBox.find(".yes").unbind().click(function() {
          confirmBox.hide();
          });
          confirmBox.find(".yes").click();
          confirmBox.show();
          window.location.reload();
        }
      }
      if(posthttp.status == 500) {
          console.log("ASK Failed");
          var confirmBox = $("#confirm");
          confirmBox.find(".message").text("Submit Failed");
          confirmBox.find(".yes").unbind().click(function() {
          confirmBox.hide();
          });
          confirmBox.find(".yes").click();
          confirmBox.show();
      }
      if (this.status == 403 ){
        throwblocked();
      }
    }
    const posturl= "http://"+ip+":"+port+"/Axon/action/submitPayLoadService.jsp?"+postdata

    posthttp.open("POST", proxy+posturl);
    posthttp.setRequestHeader('username', user);
    posthttp.send();

  }

  function getname(elt,tagele) {
    var que = document.getElementById(tagele).value
    if(typeof que !== undefined && que !== null){
      var namehttp = new XMLHttpRequest();
      namehttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200 ) {
          const nameres = namehttp.responseXML
          var keyname = nameres.getElementsByTagName("key")[0].innerHTML;
          var valuename = nameres.getElementsByTagName("value")[0].innerHTML;
          document.getElementById(tagele).value = valuename;
          document.getElementById("auxdata").innerHTML+="<input type='hidden' name='"+tagele+"' value='"+keyname+"'>"
        }
        if (this.status == 403 ){
          throwblocked();
        }
      }
      const nameurl= "http://"+ip+":"+port+"/Axon/getNameData.jsp?elt="+elt+"&q="+que

      namehttp.open("GET", proxy+nameurl);
      namehttp.overrideMimeType('text/xml');
      namehttp.setRequestHeader('username', user);
      namehttp.send();
    }

  }

  function getContents3(name,url){
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        Dx = xhr.responseXML;
        xxr = Dx.getElementsByTagName("Name");
        document.getElementById("innerdata1").innerHTML="<h3>"+name+"</h3><br>";
        inner_url="";
        xr=[];
        document.getElementById("spldata").innerHTML=""
        for (i = 0; i< xxr.length; i++) {
          inner_url=xxr[i].children[0].innerHTML;
          xr[i] = new XMLHttpRequest();
          xr[i].onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              Dxx = this.responseXML;
              xxxr = Dxx.getElementsByTagName("Element");
              var check=""+inner_url.search("Ask")
              if (check >0) {
                console.log("Inside Ask");
                document.getElementById("innerdata").innerHTML=""
                document.getElementById("innertable").innerHTML=""
                document.getElementById("spldata").innerHTML=""
                hea=[]
                boa=[]
                for (i = 0; i< xxxr.length;i++){
                  if(xxxr[i].children[1].innerHTML=="date"){
                    if(xxxr[i].children.length==3){
                      //document.getElementById("innerdata").innerHTML+="<tr><td>"+xxxr[i].children[0].innerHTML+" :</td> <td><input class='form-control' type='date' value='"+xxxr[i].children[2].innerHTML+"'> </td></tr>"
                      hea.push(xxxr[i].children[0].innerHTML)
                      boa.push("<td><input class='form-control' type='date' id='oneask"+i+"' value='"+xxxr[i].children[2].innerHTML+"'> </td>")
                    }else{
                      //document.getElementById("innerdata").innerHTML+="<tr><td>"+xxxr[i].children[0].innerHTML+" :</td> <td><input class='form-control' type='date'> </td></tr>"
                      hea.push(xxxr[i].children[0].innerHTML)
                      boa.push("<td><input class='form-control' type='date' id='oneask"+i+"'> </td>")
                    }
                  }
                  else if(xxxr[i].children[1].innerHTML=="number"){
                    if(xxxr[i].children.length==3){
                      //document.getElementById("innerdata").innerHTML+="<tr><td>"+xxxr[i].children[0].innerHTML+" :</td><td> <input class='form-control' type='number' value='"+xxxr[i].children[2].innerHTML+"'> </td></tr>"
                      hea.push(xxxr[i].children[0].innerHTML)
                      boa.push("<td><input class='form-control' type='number' id='oneask"+i+"' value='"+xxxr[i].children[2].innerHTML+"'> </td>")
                    }else{
                      //document.getElementById("innerdata").innerHTML+="<tr><td>"+xxxr[i].children[0].innerHTML+" :</td><td> <input class='form-control' type='number'> </td></tr>"
                      hea.push(xxxr[i].children[0].innerHTML)
                      boa.push("<td><input class='form-control' type='number' id='oneask"+i+"'> </td>")
                    }  
                  }
                  else if(xxxr[i].children[1].innerHTML=="name"){
                      //document.getElementById("innerdata").innerHTML+="<tr><td>"+xxxr[i].children[0].innerHTML+" :</td><td> <input class='form-control' type='text'> </td></tr>"
                      hea.push(xxxr[i].children[0].innerHTML)
                      boa.push("<td> <input class='form-control' type='text' id='oneask"+i+"' onchange='getname(`"+xxxr[i].children[0].innerHTML+"`,`oneask"+i+"`)'> </td>")
                  }
                  else{
                    if(xxxr[i].children.length==3){
                      //document.getElementById("innerdata").innerHTML+="<tr><td>"+xxxr[i].children[0].innerHTML+" :</td><td> <input class='form-control' type='text' value='"+xxxr[i].children[2].innerHTML+"'> </td></tr>"
                      hea.push(xxxr[i].children[0].innerHTML)
                      boa.push("<td> <input class='form-control' type='text' id='oneask"+i+"' value='"+xxxr[i].children[2].innerHTML+"'> </td>")
                    }else{
                      //document.getElementById("innerdata").innerHTML+="<tr><td>"+xxxr[i].children[0].innerHTML+" :</td><td> <input class='form-control' type='text'> </td></tr>"
                      hea.push(xxxr[i].children[0].innerHTML)
                      boa.push("<td> <input class='form-control' type='text' id='oneask"+i+"'> </td>")
                    }
                  }
                }
                var askttble = "<thead><tr>"
                for (var he of hea){askttble+="<th>"+he+"</th>"}
                askttble+="</tr></thead>"
                askttble+="<tr>"
                for (var bod of boa){askttble+=bod}
                askttble+="<td><input class='btn btn-primary btn-rounded btn-fw' type='submit' onclick='postask1(`"+inner_url+"`,`"+hea+"`,`oneask`)' value='submit'> </td>"
                askttble+="</tr>"
                document.getElementById("innerdata").innerHTML=askttble

              }
              else {
                console.log("Inside Tell");
                document.getElementById("innerdata").innerHTML=""
                document.getElementById("innertable").innerHTML=""
                // document.getElementById("innerdata").innerHTML="<thead><tr><th>Data</th><th>Value</th></tr></thead>"
                if(xr.length>1){
                  for (i = 0; i< xxxr.length;i++){
                    if (xxxr[i].children[1].innerHTML=="name") {
                      document.getElementById("spldata").innerHTML+="<div class='grid-item'><button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+xxxr[i].children[2].innerHTML+"`)'>"+xxxr[i].children[0].innerHTML+"</button></div>";
                    }
                  }
                }
                else {
                  document.getElementById("spldata").innerHTML=""
                  headdata=[]
                  bodydata=[]
                  for (i = 0; i< xxxr.length;i++){
                    if (xxxr[i].children[1].innerHTML=="name") {
                      if(xxxr[i].children.length>2){
                        getroot(xxxr[i].children[2].innerHTML)
                        headdata.push("Pointer")
                        bodydata.push("<button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+xxxr[i].children[2].innerHTML+"`)'>"+xxxr[i].children[0].innerHTML+"</button>")
                        //document.getElementById("innerdata").innerHTML+="<tr><td colspan='2' style='text-align:center;'><button class='btn btn-primary btn-rounded btn-fw' onclick='getContent4(`"+xxxr[i].children[2].innerHTML+"`)'>"+xxxr[i].children[0].innerHTML+"</button></td></tr>";
                      }else{
                        continue
                      }
                    }
                    else {
                      if(xxxr[i].children.length>2){
                        headdata.push(xxxr[i].children[0].innerHTML)
                        bodydata.push(xxxr[i].children[2].innerHTML)
                      }
                      //document.getElementById("innerdata").innerHTML+="<tr><td>"+xxxr[i].children[0].innerHTML+"</td><td>"+xxxr[i].children[2].innerHTML+"</td></tr>";
                    }
                  }
                  var ttble = "<thead><tr>"
                  for (var hea of headdata){ttble+="<th>"+hea+"</th>"}
                  ttble+="</tr></thead>"
                  ttble+="<tr>"
                  for (var bod of bodydata){ttble+="<td>"+bod+"</td>"}
                  ttble+="</tr>"
                  document.getElementById("innerdata").innerHTML=ttble
                }
              }
            }
            if (this.status == 403 ){
              throwblocked();
            }
          }
          xr[i].open("GET", proxy+inner_url,true);
          xr[i].overrideMimeType('text/xml');
          xr[i].setRequestHeader('username', user);
          xr[i].send();
        }
      }
      if (this.status == 403 ){
        throwblocked();
      }
    }
    xhr.open("GET", proxy+url,true);
    xhr.overrideMimeType('text/xml');
    xhr.setRequestHeader('username', user);
    xhr.send(); 
  }

  //left side menu
  function getContent2(url, tag, pname) {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        Doc = xhr.responseXML;
        xxx = Doc.getElementsByTagName(tag);
        const menuContainer = document.getElementById('tree-simple3');
        menuContainer.innerHTML = ''; // Clear existing menu items

        // Make the menu visible
        menuContainer.style.display = 'block';

        for (let i = 0; i < xxx.length; i++) {
          const val_name = xxx[i].children[0].innerHTML;
          const val_uri = xxx[i].children[1].innerHTML;

          // Create a menu item
          const menuItem = document.createElement('div');
          menuItem.classList.add('menu-item');
          menuItem.textContent = val_name;

          // Attach click event to call getContents3
          menuItem.onclick = function() {
              getContents3(pname+" : "+val_name, val_uri);
          };

          // Append menu item to the container
          menuContainer.appendChild(menuItem);
        }
      }
      if (this.status == 403) {
          throwblocked();
      }
    };
    xhr.open("GET", proxy + url, true);
    xhr.overrideMimeType('text/xml');
    xhr.setRequestHeader('username', user);
    xhr.send();
  }
  
  //subdrop down menu
  function getContent(url, tag, pname, dropdownMenu) {
    cls();
    var http = new XMLHttpRequest();
    http.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        dropdownMenu.innerHTML = ''; // Clear existing submenu items

        xDoc = http.responseXML;
        const elements = xDoc.getElementsByTagName(tag);

        for (let i = 0; i < elements.length; i++) {
          const optionName = elements[i].children[0].innerHTML;
          const optionValue = elements[i].children[1].innerHTML;

          const submenuItem = document.createElement('a');
          submenuItem.classList.add('dropdown-item');
          submenuItem.textContent = optionName;
          submenuItem.href = 'javascript:void(0);';
          submenuItem.onclick = function() {
            getContent2(optionValue, 'Action', optionName);
          };

          dropdownMenu.appendChild(submenuItem);
        }
      }
      if (this.status == 403) {
        throwblocked();
      }
    };
    http.open("GET", proxy + url, true);
    http.overrideMimeType('text/xml');
    http.setRequestHeader('username', user);
    http.send();
  }

  function load() {
    ip = window.sessionStorage.getItem("ip");
    port = window.sessionStorage.getItem("port");
    proxy = window.sessionStorage.getItem("proxy");
    user = window.sessionStorage.getItem("user");
    console.log(ip, port, proxy, user);

    // Load initial data or setup
    loadInitialData();
  }

  function loadInitialData() {
    window.allowedProcesses = [ "User","Models", "Assemblies", "TestChains", "AssemblyTests", "SubAssemblies"];
    
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        const navbarMenuWrapper = document.querySelector('.navbar-menu-wrapper');
        navbarMenuWrapper.innerHTML = ''; // Clear existing menu items

        xmlDoc = xmlhttp.responseXML;
        const processes = xmlDoc.getElementsByTagName("Process");

        for (let i = 0; i < processes.length; i++) {
          const processName = processes[i].children[0].innerHTML;
          const processUrl = processes[i].children[1].innerHTML;

          // Add menu item only if it exists in allowedProcesses array
          if (window.allowedProcesses && !window.allowedProcesses.includes(processName)) {
            continue; // Skip this process if not in allowlist
          }

          // Create a dropdown container
          const dropdownContainer = document.createElement('div');
          dropdownContainer.classList.add('dropdown');

          // Create the main menu item
          const menuItem = document.createElement('a');
          menuItem.textContent = processName;
          menuItem.classList.add('text-primary', 'dropdown-toggle');
          menuItem.style.paddingLeft = '5px';
          menuItem.style.marginLeft = '10px';
          menuItem.href = '#';
          menuItem.setAttribute('data-toggle', 'dropdown');
          menuItem.setAttribute('aria-haspopup', 'true');
          menuItem.setAttribute('aria-expanded', 'false');

          // Create the dropdown menu
          const dropdownMenu = document.createElement('div');
          dropdownMenu.classList.add('dropdown-menu');

          // Attach click event to load submenu items
          menuItem.onclick = function() {
            cls();
            getContent(processUrl, 'Pid', processName, dropdownMenu);
          };

          // Append menu item and dropdown to the container
          dropdownContainer.appendChild(menuItem);
          dropdownContainer.appendChild(dropdownMenu);
          navbarMenuWrapper.appendChild(dropdownContainer);
        }
        //add static menu to the navbarmenuwrapper
        const visualizeMenu = document.createElement('a');
        visualizeMenu.textContent = 'Visualize';
        visualizeMenu.classList.add('text-primary');
        visualizeMenu.style.paddingLeft = '5px';
        visualizeMenu.style.marginLeft = '10px';
        visualizeMenu.href = 'javascript:void(0);';
        visualizeMenu.onclick = function() {
          cls();
          document.getElementById('visualizeDiv').style.display = 'block';
        };
        navbarMenuWrapper.appendChild(visualizeMenu);
      }
      if (this.status == 403) {
        throwblocked();
      }
    };
    xmlhttp.open("GET", proxy + "http://" + ip + ":" + port + "/Axon/MasterKube/general/masterkube", true);
    xmlhttp.overrideMimeType('text/xml');
    xmlhttp.setRequestHeader('username', user);
    xmlhttp.send();
  }

  function throwblocked(){
    var confirmBox = $("#confirm");
    confirmBox.find(".message").text("Access Denied");
    confirmBox.find(".yes").unbind().click(function() {
    confirmBox.hide();
    });
    confirmBox.find(".yes").click();
    confirmBox.show();
  }

  function cls(){
    document.getElementById("tree-simple3").innerHTML=""
    document.getElementById("innerdata1").innerHTML=""
    document.getElementById("innerdata").innerHTML=""
    document.getElementById("innertable").innerHTML=""
    document.getElementById("spldata").innerHTML=""
    document.getElementById("demo").innerHTML=""
    document.getElementById('visualizeDiv').style.display = 'none';
  }

  function clstable(){
    document.getElementById("innerdata").innerHTML=""
    document.getElementById("innertable").innerHTML=""
  }


 </script>


</head>
<body onload="load()">
  <div id="video_wrapper">
    <div id="wrapper">
     <div>
          <!-- partial:partials/_navbar.html -->
          <nav class="navbar p-0 fixed-top d-flex flex-row" style="font-size: 15px;">
            <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
              <a class="navbar-brand brand-logo mr-5" href="index.html"><img src="./images/Logo.png" class="mr-2" alt="logo"/></a>
            </div>
            <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
              <!-- Add dropdown menu here -->
              <div class="dropdown">
                <a class="text-primary dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Select an option
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown" id="dropdownMenu">
                  <!-- Options will be dynamically loaded here -->
                </div>
              </div>
            </div>
          </nav>
            <ul id="mylist"></ul>
            <div id="demo"></div>
            <div id="tree-simple3"> </div>
            <div style="font-size: 25px;">
              <div id="innerdata1" style="display: flex; align-items: center; justify-content: center; margin-top: 20px; text-align: center; color: #000000;"></div>
              <div class="table grid-container" id="spldata"  style="margin-top: 20px;"></div>
              <table class="table" style="width: auto;" id="innerdata"  style="margin-top: 20px; color: #000000;"></table>
              <table class="table" style="width: auto;" id="innertable"  style="margin-top: 20px; color: #000000;"></table>
              <div id="auxdata" ></div>
              <div id="visualizeDiv" style="display: none; margin-top: 20px; text-align: center; color: #000000;">
                <h3>Visualization Content</h3>
              </div>
            </div>
            <div id="confirm">
              <div class="message" ></div><br>
              <button class="yes">Close</button>
            </div>
     </div>

  <script src="js/dataTables.select.min.js"></script>

  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="js/off-canvas.js"></script>
  <script src="js/hoverable-collapse.js"></script>
  <script src="js/template.js"></script>
  <script src="js/settings.js"></script>
  <script src="js/todolist.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="js/dashboard.js"></script>
  <script src="js/Chart.roundedBarCharts.js"></script>
  <!-- End custom js for this page-->
</body>

</html>

